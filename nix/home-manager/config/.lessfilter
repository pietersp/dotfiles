#! /usr/bin/env sh
# this is a example of .lessfilter, you can change it
mime=$(file -bL --mime-type "$1")
category=${mime%%/*}
kind=${mime##*/}
if [ -d "$1" ]; then
  tree -c $1 | head -50
	# if [ "$(command -v exa)" ]; then
	# 	exa --git -hl --color=always --icons "$1"
	# fi
elif [ "$category" = application ]; then
  if [ "$(command -v hx)" ]; then
    hx -l 512 "$1"
  fi
elif [ "$kind" = octet-stream ]; then
  if [ "$(command -v hx)" ]; then
    hx -l 512 "$1"
  fi
elif [ "$kind" = json ]; then
	if [ "$(command -v jq)" ]; then
		jq -Cr . "$1"
	fi
elif [ "$category" = image ]; then
	if [ "$(command -v chafa)" ]; then
		chafa -f symbols -s "$FZF_PREVIEW_LINESx$FZF_PREVIEW_COLUMNS" "$1"
	fi
	if [ "$(command -v exiftool)" ]; then
		exiftool "$1" | bat --color=always -plyaml
	fi
elif [ "$category" = text ]; then
	if [ "$(command -v bat)" ]; then
		bat --color=always "$1"
	elif [ "$(command -v pygmentize)" ]; then
		pygmentize "$1" | less
	fi
else
  exit 1
#	lesspipe.sh "$1" | bat --color=always
fi
# lesspipe.sh don't use exa, bat and chafa, it use ls and exiftool. so we create a lessfilter.
